{
    "$schema": "https://openapi.vercel.sh/vercel.json",
    "framework": null,

    "functions": {
        "api/index.php": {
            "runtime": "vercel-php@0.7.4",
            "memory": 1024,
            "maxDuration": 60
        }
    },

    "rewrites": [
        { "source": "/build/(.*)", "destination": "/public/build/$1" },
        { "source": "/storage/(.*)", "destination": "/public/storage/$1" },
        { "source": "/(.*)", "destination": "/api/index.php" }
    ],

    "installCommand": "npm ci || pnpm i || yarn --immutable || true",

    "buildCommand": "composer install --no-dev --prefer-dist --optimize-autoloader && php -r \"is_dir('storage/framework/views') || mkdir('storage/framework/views', 0777, true);\" && php -r \"is_dir('storage/framework/cache') || mkdir('storage/framework/cache', 0777, true);\" && php artisan config:cache && php artisan route:cache && php artisan view:cache && composer run vercel || true && npm run build",

    "headers": [
        {
            "source": "/build/(.*)",
            "headers": [
                {
                    "key": "Cache-Control",
                    "value": "public, max-age=31536000, immutable"
                }
            ]
        },
        {
            "source": "/storage/(.*)",
            "headers": [
                { "key": "Cache-Control", "value": "public, max-age=86400" }
            ]
        }
    ]
}
